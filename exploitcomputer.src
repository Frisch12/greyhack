import_code("/home/bigd/programs/init.inc.src")
import_code("/home/bigd/programs/basic.inc.src")

if params.len != 4 or params[0] == "-h" or params[0] == "--help" then exit("<b>Usage: "+program_path.split("/")[-1]+" [ip_address] [port] [memory_address] [string]</b>")

exploits = [[params[2], params[3]]]

res = _exploit_remote(exploits)

res = res.File("/")

while res.parent != null
    res = res.parent
end while

print("Found: " + res.path)

folders = res.get_folders
for f in folders
    if f.name == "etc" then
        res = f
        print("Found /etc")
        break
    end if
end for

folders = res.get_files
for f in folders
    if f.name == "passwd" then
        res = f
        print("Found /etc/passwd")
        break
    end if
end for

if not res or res.is_binary or res.is_folder then
    print("Failed to get file /etc/passwd")
    exit
end if 

print(res.get_content)
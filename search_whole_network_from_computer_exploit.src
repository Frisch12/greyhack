import_code("/home/bigd/programs/init.inc.src")
import_code("/home/bigd/programs/basic.inc.src")
import_code("/home/bigd/programs/file.inc.src")

if params.len != 5 or params[0] == "-h" or params[0] == "--help" then exit("<b>Usage: "+program_path.split("/")[-1]+" [ip_address] [port] [memory_address] [string] [files_with_ips]</b>")

ips = get_shell.host_computer.File(_get_file_relative_or_absolute(params[4])).get_content.split("\n")

for ip in ips 
    if ip.trim == "" then continue
    exploits = [[params[2], params[3], ip]]

    res = _exploit_remote(exploits)

    _print_content = function (root, path)
        file = _find_file(root, path)
        if not file or file.is_binary or file.is_folder then
            print("Failed to get file " + path)
        else
            print(file.get_content)
        end if 
    end function

    root = res.File("/home")

    print(ip + ":\n")

    for folder in root.get_folders
        files = folder.get_files
        if files.len > 0 then
            for file in files
                print ("    " + file.name + "\n")
            end for
        end if
    end for
    print("\n")
end for